<div class="container-fluid settingsForm">
  <div class="row">
    <!-- Colonna Profilo -->
    <div class="col-md-6 mb-4">
      <form class="card p-4" [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
        <h2 class="text-center mb-4">Impostazioni Profilo</h2>

        <div *ngIf="profileErrorMessage" class="alert alert-danger">
          {{ profileErrorMessage }}
        </div>
        <div *ngIf="profileSuccessMessage" class="alert alert-success">
          {{ profileSuccessMessage }}
        </div>

        <div class="mb-3">
          <label for="fullName">Nome Completo</label>
          <div class="error-message" *ngIf="isInvalidAndTouched('fullName', 'profile')">
            {{ getErrorMessage('fullName', 'profile') }}
          </div>
          <input type="text" id="fullName" class="form-control" formControlName="fullName"
            (blur)="markAsTouched('fullName', 'profile')"
            [class.is-invalid-shake]="isInvalidAndTouched('fullName', 'profile')" />
        </div>

        <div class="mb-3">
          <label for="emailPassword">Email</label>
          <div class="error-message" *ngIf="isInvalidAndTouched('email', 'profile')">
            {{ getErrorMessage('email', 'profile') }}
          </div>
          <input type="email" id="emailPassword" class="form-control" formControlName="email" readonly />
        </div>

        <div class="mb-3">
          <label for="companyName">Nome Azienda</label>
          <div class="error-message" *ngIf="isInvalidAndTouched('companyName', 'profile')">
            {{ getErrorMessage('companyName', 'profile') }}
          </div>
          <input type="text" id="companyName" class="form-control" formControlName="companyName"
            (blur)="markAsTouched('companyName', 'profile')"
            [class.is-invalid-shake]="isInvalidAndTouched('companyName', 'profile')" />
        </div>

        <div class="mb-4">
          <label for="phone">Numero di Telefono</label>
          <div class="error-message" *ngIf="isInvalidAndTouched('phone', 'profile')">
            {{ getErrorMessage('phone', 'profile') }}
          </div>
          <input type="text" id="phone" class="form-control" formControlName="phone"
            (blur)="markAsTouched('phone', 'profile')"
            [class.is-invalid-shake]="isInvalidAndTouched('phone', 'profile')" />
        </div>

        <button type="submit" class="btn btn-primary w-100">
          Aggiorna Credenziali
        </button>
      </form>
    </div>

    <!-- Colonna Reset Password -->
    <div class="col-md-6 mb-4">
      <div class="text-center">
        <button class="btn-outline-danger mb-3" (click)="showPasswordPanel = !showPasswordPanel">
          {{ showPasswordPanel ? '‚ùå Chiudi' : 'üîí Reset Password' }}
        </button>
      </div>

      <div [ngClass]="{'password-panel-wrapper': true, 'open': showPasswordPanel}">
        <form class="card" [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()">

          <div *ngIf="passwordErrorMessage" class="alert alert-danger">
            {{ passwordErrorMessage }}
          </div>
          <div *ngIf="passwordSuccessMessage" class="alert alert-success">
            {{ passwordSuccessMessage }}
          </div>

          <!-- Email come testo, non input -->
          <div class="mb-3">
            <label>Email</label>
            <div class="form-control-plaintext">{{ profileForm.get('email')?.value }}</div>
          </div>

          <div class="mb-3">
            <label for="currentPassword">Password Attuale</label>
            <div class="error-message" *ngIf="isInvalidAndTouched('currentPassword', 'password')">
              {{ getErrorMessage('currentPassword', 'password') }}
            </div>
            <input type="password" id="currentPassword" class="form-control" formControlName="currentPassword"
              (blur)="markAsTouched('currentPassword', 'password')"
              [class.is-invalid-shake]="isInvalidAndTouched('currentPassword', 'password')" />
          </div>

          <div class="mb-4">
            <label for="newPassword">Nuova Password</label>
            <div class="error-message" *ngIf="isInvalidAndTouched('newPassword', 'password')">
              {{ getErrorMessage('newPassword', 'password') }}
            </div>
            <input type="password" id="newPassword" class="form-control" formControlName="newPassword"
              (blur)="markAsTouched('newPassword', 'password')"
              [class.is-invalid-shake]="isInvalidAndTouched('newPassword', 'password')" />
          </div>

          <button type="submit" class="btn btn-danger w-100">
            Cambia Password
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
